{"ast":null,"code":"var _jsxFileName = \"C:\\\\xampp\\\\htdocs\\\\MSU-Video-Streaming-Project\\\\new\\\\src\\\\components\\\\player.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport Hls from 'hls.js';\nimport { insertHistories } from './saveHistories';\nimport { getUser, isSessionSet } from './session';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VideoPlayer = ({\n  source,\n  V_id,\n  watchTime\n}) => {\n  _s();\n  const videoRef = useRef(null);\n  const [hls, setHls] = useState(null);\n  const [resolutions, setResolutions] = useState(null);\n  useEffect(() => {\n    const loadVideo = async () => {\n      if (typeof Hls === 'undefined') return;\n      if (!Hls.isSupported()) return;\n      const video = videoRef.current;\n      const tmpHls = new Hls();\n      tmpHls.loadSource(source);\n      tmpHls.attachMedia(video);\n      setHls(tmpHls);\n      video.currentTime = watchTime;\n      video.autoplay = true;\n      tmpHls.on(Hls.Events.MANIFEST_PARSED, () => {\n        const tmp = tmpHls.levels;\n        tmpHls.currentLevel = tmp.length - 1;\n        setResolutions(tmp);\n      });\n    };\n    loadVideo();\n  }, [source]);\n  useEffect(() => {\n    const video = videoRef.current;\n    let c_time = 0;\n    const handleTime = async e => {\n      const dif_time = video.currentTime - c_time;\n      if (dif_time >= 20) {\n        c_time = video.currentTime;\n        const tmp = {\n          'watchTime': video.currentTime,\n          'V_id': V_id,\n          'U_id': getUser()\n        };\n        await insertHistories(tmp);\n      }\n    };\n    const handleEnd = async e => {\n      const tmp = {\n        'watchTime': 0,\n        'V_id': V_id,\n        'U_id': getUser()\n      };\n      await insertHistories(tmp);\n    };\n    const handlePause = async e => {\n      const tmp = {\n        'watchTime': video.currentTime,\n        'V_id': V_id,\n        'U_id': getUser()\n      };\n      await insertHistories(tmp);\n    };\n    if (isSessionSet('session')) {\n      video.addEventListener('timeupdate', handleTime);\n      video.addEventListener('ended', handleEnd);\n      video.addEventListener('pause', handlePause);\n    }\n    return () => {\n      if (isSessionSet('session')) {\n        video.removeEventListener('timeupdate', handleTime);\n        video.removeEventListener('ended', handleEnd);\n        video.removeEventListener('pause', handlePause);\n      }\n    };\n  }, [V_id]);\n  useEffect(() => {\n    const video = videoRef.current;\n    return () => {\n      if (hls) {\n        hls.destroy();\n      }\n      video.removeAttribute('src');\n    };\n  }, [hls]);\n  const resChange = e => {\n    const level = e.target.value;\n    if (level !== 'auto') {\n      hls.currentLevel = parseInt(level);\n    } else {\n      hls.currentLevel = resolutions.length - 1;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container-fluid\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: /*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        controls: true,\n        children: \"Your browser does not support the video tag.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"select\", {\n        onChange: resChange,\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: 'auto',\n          children: \"Auto\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 11\n        }, this), resolutions && resolutions.map((res, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: index,\n          children: res.height\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this);\n};\n_s(VideoPlayer, \"vomoMz0ECljLPIBUygcXCdSOBdo=\");\n_c = VideoPlayer;\nexport default VideoPlayer;\nvar _c;\n$RefreshReg$(_c, \"VideoPlayer\");","map":{"version":3,"names":["React","useEffect","useRef","useState","Hls","insertHistories","getUser","isSessionSet","jsxDEV","_jsxDEV","VideoPlayer","source","V_id","watchTime","_s","videoRef","hls","setHls","resolutions","setResolutions","loadVideo","isSupported","video","current","tmpHls","loadSource","attachMedia","currentTime","autoplay","on","Events","MANIFEST_PARSED","tmp","levels","currentLevel","length","c_time","handleTime","e","dif_time","handleEnd","handlePause","addEventListener","removeEventListener","destroy","removeAttribute","resChange","level","target","value","parseInt","className","children","ref","controls","fileName","_jsxFileName","lineNumber","columnNumber","onChange","map","res","index","height","_c","$RefreshReg$"],"sources":["C:/xampp/htdocs/MSU-Video-Streaming-Project/new/src/components/player.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport Hls from 'hls.js';\r\nimport { insertHistories } from './saveHistories';\r\nimport { getUser, isSessionSet } from './session';\r\n\r\nconst VideoPlayer = ({ source, V_id, watchTime }) => {\r\n  const videoRef = useRef(null);\r\n  const [hls, setHls] = useState(null);\r\n  const [resolutions, setResolutions] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const loadVideo = async () => {\r\n      if (typeof Hls === 'undefined') return;\r\n      if (!Hls.isSupported()) return;\r\n\r\n      const video = videoRef.current;\r\n      const tmpHls = new Hls();\r\n\r\n      tmpHls.loadSource(source);\r\n      tmpHls.attachMedia(video);\r\n\r\n      setHls(tmpHls);\r\n      video.currentTime = watchTime;\r\n      video.autoplay = true;\r\n\r\n      tmpHls.on(Hls.Events.MANIFEST_PARSED, () => {\r\n        const tmp = tmpHls.levels;\r\n        tmpHls.currentLevel = tmp.length - 1;\r\n        setResolutions(tmp);\r\n      });\r\n    };\r\n\r\n    loadVideo();\r\n\r\n  }, [source]);\r\n\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n    let c_time = 0;\r\n\r\n    const handleTime = async (e) => {\r\n      const dif_time = video.currentTime - c_time;\r\n      \r\n      if(dif_time >= 20) {\r\n        c_time = video.currentTime;\r\n        const tmp = {\r\n          'watchTime': video.currentTime,\r\n          'V_id': V_id,\r\n          'U_id': getUser()\r\n        }\r\n        await insertHistories(tmp);\r\n      }\r\n    }\r\n\r\n    const handleEnd= async (e) => {\r\n        const tmp = {\r\n          'watchTime': 0,\r\n          'V_id': V_id,\r\n          'U_id': getUser()\r\n        }\r\n        await insertHistories(tmp);\r\n    }\r\n\r\n    const handlePause= async (e) => {\r\n      const tmp = {\r\n        'watchTime': video.currentTime,\r\n        'V_id': V_id,\r\n        'U_id': getUser()\r\n      }\r\n      await insertHistories(tmp);\r\n  }\r\n\r\n    if(isSessionSet('session')) {\r\n      video.addEventListener('timeupdate', handleTime)\r\n      video.addEventListener('ended', handleEnd);\r\n      video.addEventListener('pause', handlePause);\r\n    }\r\n\r\n    return () => {\r\n      if(isSessionSet('session')) {\r\n        video.removeEventListener('timeupdate', handleTime);\r\n        video.removeEventListener('ended', handleEnd);\r\n        video.removeEventListener('pause', handlePause);\r\n      }\r\n    }\r\n  }, [V_id])\r\n\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n\r\n    return () => {\r\n      if (hls) {\r\n        hls.destroy();\r\n      }\r\n      video.removeAttribute('src');\r\n    };\r\n  }, [hls]);\r\n\r\n  const resChange = (e) => {\r\n    const level = e.target.value\r\n    if (level !== 'auto') {\r\n      hls.currentLevel = parseInt(level);\r\n    } else {\r\n      hls.currentLevel = resolutions.length - 1\r\n\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className='container-fluid' >\r\n      <div className='row'>\r\n        <video ref={videoRef} controls>\r\n          Your browser does not support the video tag.\r\n        </video>\r\n      </div>\r\n      <div>\r\n        <select onChange={resChange}>\r\n          <option value={'auto'}>Auto</option>\r\n          {resolutions && resolutions.map((res, index) => (\r\n            <option key={index} value={index} >{res.height}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoPlayer;\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAC1D,OAAOC,GAAG,MAAM,QAAQ;AACxB,SAASC,eAAe,QAAQ,iBAAiB;AACjD,SAASC,OAAO,EAAEC,YAAY,QAAQ,WAAW;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAElD,MAAMC,WAAW,GAAGA,CAAC;EAAEC,MAAM;EAAEC,IAAI;EAAEC;AAAU,CAAC,KAAK;EAAAC,EAAA;EACnD,MAAMC,QAAQ,GAAGb,MAAM,CAAC,IAAI,CAAC;EAC7B,MAAM,CAACc,GAAG,EAAEC,MAAM,CAAC,GAAGd,QAAQ,CAAC,IAAI,CAAC;EACpC,MAAM,CAACe,WAAW,EAAEC,cAAc,CAAC,GAAGhB,QAAQ,CAAC,IAAI,CAAC;EAEpDF,SAAS,CAAC,MAAM;IACd,MAAMmB,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC5B,IAAI,OAAOhB,GAAG,KAAK,WAAW,EAAE;MAChC,IAAI,CAACA,GAAG,CAACiB,WAAW,CAAC,CAAC,EAAE;MAExB,MAAMC,KAAK,GAAGP,QAAQ,CAACQ,OAAO;MAC9B,MAAMC,MAAM,GAAG,IAAIpB,GAAG,CAAC,CAAC;MAExBoB,MAAM,CAACC,UAAU,CAACd,MAAM,CAAC;MACzBa,MAAM,CAACE,WAAW,CAACJ,KAAK,CAAC;MAEzBL,MAAM,CAACO,MAAM,CAAC;MACdF,KAAK,CAACK,WAAW,GAAGd,SAAS;MAC7BS,KAAK,CAACM,QAAQ,GAAG,IAAI;MAErBJ,MAAM,CAACK,EAAE,CAACzB,GAAG,CAAC0B,MAAM,CAACC,eAAe,EAAE,MAAM;QAC1C,MAAMC,GAAG,GAAGR,MAAM,CAACS,MAAM;QACzBT,MAAM,CAACU,YAAY,GAAGF,GAAG,CAACG,MAAM,GAAG,CAAC;QACpChB,cAAc,CAACa,GAAG,CAAC;MACrB,CAAC,CAAC;IACJ,CAAC;IAEDZ,SAAS,CAAC,CAAC;EAEb,CAAC,EAAE,CAACT,MAAM,CAAC,CAAC;EAEZV,SAAS,CAAC,MAAM;IACd,MAAMqB,KAAK,GAAGP,QAAQ,CAACQ,OAAO;IAC9B,IAAIa,MAAM,GAAG,CAAC;IAEd,MAAMC,UAAU,GAAG,MAAOC,CAAC,IAAK;MAC9B,MAAMC,QAAQ,GAAGjB,KAAK,CAACK,WAAW,GAAGS,MAAM;MAE3C,IAAGG,QAAQ,IAAI,EAAE,EAAE;QACjBH,MAAM,GAAGd,KAAK,CAACK,WAAW;QAC1B,MAAMK,GAAG,GAAG;UACV,WAAW,EAAEV,KAAK,CAACK,WAAW;UAC9B,MAAM,EAAEf,IAAI;UACZ,MAAM,EAAEN,OAAO,CAAC;QAClB,CAAC;QACD,MAAMD,eAAe,CAAC2B,GAAG,CAAC;MAC5B;IACF,CAAC;IAED,MAAMQ,SAAS,GAAE,MAAOF,CAAC,IAAK;MAC1B,MAAMN,GAAG,GAAG;QACV,WAAW,EAAE,CAAC;QACd,MAAM,EAAEpB,IAAI;QACZ,MAAM,EAAEN,OAAO,CAAC;MAClB,CAAC;MACD,MAAMD,eAAe,CAAC2B,GAAG,CAAC;IAC9B,CAAC;IAED,MAAMS,WAAW,GAAE,MAAOH,CAAC,IAAK;MAC9B,MAAMN,GAAG,GAAG;QACV,WAAW,EAAEV,KAAK,CAACK,WAAW;QAC9B,MAAM,EAAEf,IAAI;QACZ,MAAM,EAAEN,OAAO,CAAC;MAClB,CAAC;MACD,MAAMD,eAAe,CAAC2B,GAAG,CAAC;IAC9B,CAAC;IAEC,IAAGzB,YAAY,CAAC,SAAS,CAAC,EAAE;MAC1Be,KAAK,CAACoB,gBAAgB,CAAC,YAAY,EAAEL,UAAU,CAAC;MAChDf,KAAK,CAACoB,gBAAgB,CAAC,OAAO,EAAEF,SAAS,CAAC;MAC1ClB,KAAK,CAACoB,gBAAgB,CAAC,OAAO,EAAED,WAAW,CAAC;IAC9C;IAEA,OAAO,MAAM;MACX,IAAGlC,YAAY,CAAC,SAAS,CAAC,EAAE;QAC1Be,KAAK,CAACqB,mBAAmB,CAAC,YAAY,EAAEN,UAAU,CAAC;QACnDf,KAAK,CAACqB,mBAAmB,CAAC,OAAO,EAAEH,SAAS,CAAC;QAC7ClB,KAAK,CAACqB,mBAAmB,CAAC,OAAO,EAAEF,WAAW,CAAC;MACjD;IACF,CAAC;EACH,CAAC,EAAE,CAAC7B,IAAI,CAAC,CAAC;EAEVX,SAAS,CAAC,MAAM;IACd,MAAMqB,KAAK,GAAGP,QAAQ,CAACQ,OAAO;IAE9B,OAAO,MAAM;MACX,IAAIP,GAAG,EAAE;QACPA,GAAG,CAAC4B,OAAO,CAAC,CAAC;MACf;MACAtB,KAAK,CAACuB,eAAe,CAAC,KAAK,CAAC;IAC9B,CAAC;EACH,CAAC,EAAE,CAAC7B,GAAG,CAAC,CAAC;EAET,MAAM8B,SAAS,GAAIR,CAAC,IAAK;IACvB,MAAMS,KAAK,GAAGT,CAAC,CAACU,MAAM,CAACC,KAAK;IAC5B,IAAIF,KAAK,KAAK,MAAM,EAAE;MACpB/B,GAAG,CAACkB,YAAY,GAAGgB,QAAQ,CAACH,KAAK,CAAC;IACpC,CAAC,MAAM;MACL/B,GAAG,CAACkB,YAAY,GAAGhB,WAAW,CAACiB,MAAM,GAAG,CAAC;IAE3C;EACF,CAAC;EAED,oBACE1B,OAAA;IAAK0C,SAAS,EAAC,iBAAiB;IAAAC,QAAA,gBAC9B3C,OAAA;MAAK0C,SAAS,EAAC,KAAK;MAAAC,QAAA,eAClB3C,OAAA;QAAO4C,GAAG,EAAEtC,QAAS;QAACuC,QAAQ;QAAAF,QAAA,EAAC;MAE/B;QAAAG,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAO;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC,eACNjD,OAAA;MAAA2C,QAAA,eACE3C,OAAA;QAAQkD,QAAQ,EAAEb,SAAU;QAAAM,QAAA,gBAC1B3C,OAAA;UAAQwC,KAAK,EAAE,MAAO;UAAAG,QAAA,EAAC;QAAI;UAAAG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,EACnCxC,WAAW,IAAIA,WAAW,CAAC0C,GAAG,CAAC,CAACC,GAAG,EAAEC,KAAK,kBACzCrD,OAAA;UAAoBwC,KAAK,EAAEa,KAAM;UAAAV,QAAA,EAAGS,GAAG,CAACE;QAAM,GAAjCD,KAAK;UAAAP,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAqC,CACxD,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACI;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAAC5C,EAAA,CAxHIJ,WAAW;AAAAsD,EAAA,GAAXtD,WAAW;AA0HjB,eAAeA,WAAW;AAAC,IAAAsD,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}